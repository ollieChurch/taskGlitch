# Repeating Tasks

**Phase:** 3 | **Version:** 0.18 | **Status:** Complete

## Problem

Some tasks recur regularly (weekly reports, daily standups, monthly reviews). Users must manually recreate these each time, which is tedious and error-prone.

## Requirements

### Core

- [x] Allow tasks to be configured with a recurrence pattern
- [x] Supported patterns:
  - Daily (every N days)
  - Weekly (every N weeks, on specific days)
  - Monthly (every N months, on a specific date)
- [x] When a repeating task is completed, automatically create the next instance in the backlog
- [x] The new instance should have the same properties (priority, size, category) but a fresh creation date
- [x] The new instance's deadline should be calculated based on the recurrence pattern

### UX

- [x] Add recurrence configuration to the task creation/edit modal
- [x] Show a recurrence indicator on task cards (e.g., a repeat icon)
- [ ] Show next occurrence date on the task card
- [x] Allow editing the recurrence pattern without affecting the current instance
- [x] Allow "stopping" recurrence (convert to a one-off task)
- [x] When completing a repeating task, show brief confirmation: "Next occurrence created for [date]"

### Data Model

- [x] Add to task schema: `recurrence` (object, nullable):
  ```
  {
    type: 'daily' | 'weekly' | 'monthly',
    interval: number (every N periods),
    daysOfWeek: number[] (for weekly, 0=Sun to 6=Sat),
    dayOfMonth: number (for monthly),
    endDate: ISO timestamp (optional, stop recurrence after this date),
    endAfterCount: number (optional, stop after N occurrences),
    catchUpMissed: boolean (default false)
  }
  ```
- [x] Add to task schema: `recurrenceParentId` (string, nullable) — links instances to the original recurring task for history
- [x] Completed instances retain their recurrence info for audit trail

### Edge Cases

- [x] Recurring task is deleted (not completed) — prompt: "Skip this instance" (creates next) or "Stop all recurrences" (no next)
- [x] Recurring task is in a schedule when completed — next instance should not be added to the current schedule
- [x] Multiple instances should not pile up — completing a late task creates the next occurrence from today, not backfilled missed dates (opt-in catchUpMissed for users who need strict tracking)

## Files Affected

- `src/composables/useTaskActions.js` — `calculateNextOccurrence`, `buildRecurringInstance`, `shouldCreateNextInstance`, `getMissedOccurrences`; `moveTask()` extended
- `src/components/TaskModal.vue` — recurrence configuration UI, extended delete flow
- `src/components/TaskCard.vue` — repeat icon + recurrenceLabel computed
- `src/composables/__tests__/useTaskActions.test.js` — recurrence test suite

## Acceptance Criteria

1. [x] Users can create tasks with daily, weekly, or monthly recurrence
2. [x] Completing a recurring task automatically creates the next instance
3. [x] Recurrence indicator is visible on task cards
4. [x] Deleting a recurring task offers choice between skip instance and stop all recurrences
5. [x] Multiple instances do not pile up if tasks go uncompleted
6. [x] Recurrence can be stopped at any time
