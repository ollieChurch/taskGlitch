# Fix npm Audit Vulnerabilities

**Phase:** 1 | **Version:** 0.13 | **Status:** Complete

## Problem

`npm audit` reports 9 moderate severity vulnerabilities across two dependency chains. While neither is directly exploitable by end users, they should be resolved to keep the project healthy and avoid accumulating technical debt.

## Current Vulnerabilities (as of v0.11)

### 1. `@grpc/grpc-js` — 4 vulnerabilities

- **Severity:** Moderate
- **Issue:** Can allocate memory for incoming messages well above configured limits
- **Advisory:** GHSA-7v5v-9h63-cj86
- **Chain:** `firebase` (^9.21.0) → `@firebase/firestore-compat` → `@firebase/firestore` → `@grpc/grpc-js`
- **Fix:** Upgrade `firebase` to v12.9.0+ (breaking change — major version jump from v9)
- **Risk:** Low for TaskGlitch — the gRPC endpoint is not directly exposed to users

### 2. `esbuild` — 5 vulnerabilities

- **Severity:** Moderate
- **Issue:** Any website can send requests to the esbuild development server and read the response
- **Advisory:** GHSA-67mh-4wv8-2f99
- **Chain:** `vite` (^5.4.0) → `esbuild` (<=0.24.2), also affects `vitest` and `vite-node`
- **Fix:** Upgrade `vite` to v7.3.1+ (breaking change — major version jump from v5)
- **Risk:** Dev-only — does not affect production builds or end users

## Requirements

### Firebase Upgrade (v9 → v12+)

- [x] Review Firebase v10/v11/v12 migration guides for breaking changes
- [x] Update `firebase` package version in `package.json`
- [x] Update any changed import paths or API signatures
- [x] Verify Firebase Auth, Realtime Database, and Hosting still work correctly
- [x] Test all Firebase `onValue()` listeners in `App.vue`
- [x] Verify `markRaw()` pattern still works with new Firebase internals
- [x] Run full app smoke test (login, create task, schedule, complete task)

### Vite Upgrade (v5 → v7+)

- [x] Review Vite v6/v7 migration guides for breaking changes
- [x] Update `vite` package version in `package.json`
- [x] Update `vitest` to a compatible version
- [x] Review and update `vite.config.js` if needed
- [x] Verify dev server, HMR, and production build all work
- [x] Run test suite to confirm vitest compatibility

### Verification

- [x] `npm audit` reports 0 vulnerabilities
- [x] `npm run build` succeeds
- [x] `npm run test` passes
- [x] Manual smoke test in browser passes

## Implementation Notes

- Firebase v9 → v12: No breaking changes to the modular APIs used (`firebase/app`, `firebase/auth`, `firebase/database`). Import paths unchanged.
- Vite v5 → v7.3.1: Required `@vitejs/plugin-vue` upgrade to ^6.0.0 and `vitest` upgrade to ^3.2.0. Config files needed no changes.
- `markRaw()` wrapping on Firebase instances continues to work correctly.

## Files Affected

- `package.json` — dependency versions
- `package-lock.json` — lockfile

## Acceptance Criteria

1. ✅ `npm audit` reports 0 known vulnerabilities
2. ✅ All existing functionality works as before (no regressions)
3. ✅ Build and test commands succeed without errors
