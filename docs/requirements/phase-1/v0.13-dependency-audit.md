# Fix npm Audit Vulnerabilities

**Phase:** 1 | **Version:** 0.13 | **Status:** Not Started

## Problem

`npm audit` reports 9 moderate severity vulnerabilities across two dependency chains. While neither is directly exploitable by end users, they should be resolved to keep the project healthy and avoid accumulating technical debt.

## Current Vulnerabilities (as of v0.11)

### 1. `@grpc/grpc-js` — 4 vulnerabilities

- **Severity:** Moderate
- **Issue:** Can allocate memory for incoming messages well above configured limits
- **Advisory:** GHSA-7v5v-9h63-cj86
- **Chain:** `firebase` (^9.21.0) → `@firebase/firestore-compat` → `@firebase/firestore` → `@grpc/grpc-js`
- **Fix:** Upgrade `firebase` to v12.9.0+ (breaking change — major version jump from v9)
- **Risk:** Low for TaskGlitch — the gRPC endpoint is not directly exposed to users

### 2. `esbuild` — 5 vulnerabilities

- **Severity:** Moderate
- **Issue:** Any website can send requests to the esbuild development server and read the response
- **Advisory:** GHSA-67mh-4wv8-2f99
- **Chain:** `vite` (^5.4.0) → `esbuild` (<=0.24.2), also affects `vitest` and `vite-node`
- **Fix:** Upgrade `vite` to v7.3.1+ (breaking change — major version jump from v5)
- **Risk:** Dev-only — does not affect production builds or end users

## Requirements

### Firebase Upgrade (v9 → v12+)

- [ ] Review Firebase v10/v11/v12 migration guides for breaking changes
- [ ] Update `firebase` package version in `package.json`
- [ ] Update any changed import paths or API signatures
- [ ] Verify Firebase Auth, Realtime Database, and Hosting still work correctly
- [ ] Test all Firebase `onValue()` listeners in `App.vue`
- [ ] Verify `markRaw()` pattern still works with new Firebase internals
- [ ] Run full app smoke test (login, create task, schedule, complete task)

### Vite Upgrade (v5 → v7+)

- [ ] Review Vite v6/v7 migration guides for breaking changes
- [ ] Update `vite` package version in `package.json`
- [ ] Update `vitest` to a compatible version
- [ ] Review and update `vite.config.js` if needed
- [ ] Verify dev server, HMR, and production build all work
- [ ] Run test suite to confirm vitest compatibility

### Verification

- [ ] `npm audit` reports 0 vulnerabilities
- [ ] `npm run build` succeeds
- [ ] `npm run test` passes
- [ ] Manual smoke test in browser passes

## Files Likely Affected

- `package.json` — dependency versions
- `package-lock.json` — lockfile
- `src/App.vue` — Firebase initialisation (if API changes)
- `vite.config.js` — build config (if Vite API changes)
- `vitest.config.js` or test setup — if vitest config changes

## Acceptance Criteria

1. `npm audit` reports 0 known vulnerabilities
2. All existing functionality works as before (no regressions)
3. Build and test commands succeed without errors
